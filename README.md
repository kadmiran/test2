# 🔍 기업 분석 AI

오픈다트(DART) 공시자료와 Gemini AI를 활용한 **기업 분석 웹 애플리케이션**

**회사명과 질문만 입력하면 AI가 공시보고서 전문(50만자 이상)을 분석하여 상세하게 답변합니다!**

![](https://img.shields.io/badge/Python-3.8+-blue)
![](https://img.shields.io/badge/Flask-2.3+-green)
![](https://img.shields.io/badge/Gemini-2.5%20Pro-purple)

## ✨ 주요 기능

- 🏢 **자동 회사 검색** - 회사명만 입력하면 자동으로 정보 조회
- 🎯 **🆕 AI 기반 맞춤형 보고서 선택** - 사용자 질문을 AI가 분석하여 가장 적합한 보고서 자동 선택
- 📅 **🆕 스마트 기간 인식** - "과거 5년간", "2020년부터" 등 질문에서 기간을 자동 추출 (최대 10년)
- 💾 **🆕 VectorDB 캐싱** - FAISS + LangChain으로 보고서를 VectorDB에 저장하여 재사용 (API 호출 최소화!)
- 📈 **🆕 네이버 증권사 리포트 통합** - 종목분석 & 산업분석 리포트를 자동으로 수집하여 시장 맥락 제공
- 🏭 **🆕 산업군 자동 파악** - DART API + Gemini로 기업의 산업군을 자동 식별
- 📊 **보고서 자동 다운로드** - 질문 내용에 따라 적절한 보고서 자동 수집
- 📚 **다중 보고서 분석** - 메인 보고서 + DART 추가 보고서 + 증권사 리포트를 종합 분석
- 📄 **PDF 지원** - PDF 파일에서 텍스트 추출 및 분석 가능
- 🤖 **AI 전문 분석** - Gemini 2.5 Pro가 보고서 전문(50만자)을 분석
- 💬 **맞춤형 답변** - 사용자 질문에 대해 근거 기반 상세 분석
- 🌐 **실시간 UI** - 분석 진행상황을 실시간으로 확인
- 📥 **파일 다운로드** - ZIP/XML 형식으로 보고서 다운로드
- 🎨 **Markdown 렌더링** - 분석 결과를 보기 좋게 표시
- 🧹 **자동 파일 정리** - 분석 후 오래된 다운로드 파일 자동 정리

## 🚀 빠른 시작

### 1. 설치
```bash
pip install -r requirements.txt
```

### 2. 실행
```bash
python app.py
```

### 3. 접속
브라우저에서 **http://localhost:5000** 접속!

## 📖 사용 방법

### 3단계로 끝!

1. **회사명 입력** - 예: `삼성전자`, `SK텔레콤`, `네이버`
2. **질문 입력** - 예: `최근 재무 상태는 어떤가요?`
3. **분석 시작** - 약 1~2분 후 상세한 분석 결과 확인!

### 질문 예시

- "최근 재무 상태는 어떤가요? 매출과 영업이익 추이를 분석해주세요."
- "**과거 5년간** 매출 추이를 분석해주세요." (→ 5년치 보고서 검색)
- "**2020년부터 현재까지** 투자 내역을 정리해주세요." (→ 5년치 보고서 검색)
- "주요 사업 내용과 경쟁력을 분석해주세요."
- "**지난 10년간** 주요 인수합병 내역이 있나요?" (→ 10년치 보고서 검색)
- "향후 성장 전략과 전망을 분석해주세요."

## 🎯 핵심 기술

### Gemini 2.5 Pro의 강력한 분석력
- **Context Window**: 1,000,000 토큰 (약 400만자!)
- **보고서 전체 입력**: 55만자 보고서도 통째로 분석 가능
- **정확한 분석**: 보고서의 모든 섹션을 포괄적으로 검토
- **구조화된 답변**: 요약, 상세 분석, 수치, 결론까지 체계적으로 제공

### 실시간 진행상황 표시
```
📊 실시간 진행상황
━━━━━━━━━━━━━━━━━━━━━━━
14:07:58 - 분석 시작...
14:07:58 - 📋 1단계: '삼성전자' 회사 정보 조회 중...
14:08:48 - ✅ 회사 정보 조회 완료
14:08:49 - 📊 2단계: 보고서 검색 중...
14:08:49 - ✅ 1개의 보고서를 찾았습니다.
14:08:51 - 📥 3단계: 보고서 다운로드 중...
14:08:51 - ✅ 보고서 전체 사용: 558,804자
14:08:51 - 🤖 4단계: AI 분석 중...
14:09:52 - ✅ AI 분석 완료!
```

### Markdown 렌더링
- **제목** - 색상 및 언더라인
- **강조** - 하이라이트
- **리스트** - 구조화된 표시
- **테이블** - 그라데이션 헤더
- **코드** - 고정폭 폰트

## 📂 프로젝트 구조

```
기업분석AI/
├── app.py                   # Flask 웹 서버 (메인)
├── company_analyzer.py      # 🆕 AI 분석 핵심 로직 (2,017줄)
├── naver_finance.py         # 🆕 네이버 증권사 리포트 크롤러 (591줄)
├── vector_store.py          # 🆕 VectorDB 관리 (FAISS + LangChain, 502줄)
├── migrate_to_vectordb.py   # 🆕 기존 파일 마이그레이션 스크립트
├── disclosure_downloader.py # 공시보고서 다운로더
├── templates/
│   └── index.html          # 웹 UI (Markdown 렌더링)
├── vector_db/              # 🆕 VectorDB 저장 폴더
│   ├── index.faiss         # FAISS 인덱스
│   ├── index.pkl           # 문서 저장소
│   └── metadata.json       # 보고서 메타데이터
├── diagrams/               # 🆕 UML 다이어그램 (PlantUML)
│   ├── class_diagram.puml  # 클래스 다이어그램
│   ├── sequence_diagram.puml # 시퀀스 다이어그램
│   ├── architecture_diagram.puml # 아키텍처 다이어그램
│   ├── dataflow_diagram.puml # 데이터 플로우 다이어그램
│   └── README.md           # 다이어그램 설명
├── downloads/              # 다운로드 임시 폴더 (자동 정리됨)
├── requirements.txt        # 필요한 패키지
├── .gitignore             # Git 제외 파일
└── README.md              # 이 파일
```

## 📐 UML 다이어그램

프로젝트의 구조와 동작 방식을 시각적으로 이해하기 위한 UML 다이어그램이 제공됩니다.

- 📊 **클래스 다이어그램** - 시스템 구조 및 클래스 관계
- 🔄 **시퀀스 다이어그램** - 분석 프로세스 흐름
- 🏗️ **아키텍처 다이어그램** - C4 모델 기반 시스템 아키텍처  
- 📈 **데이터 플로우** - VectorDB 캐싱 중심의 데이터 흐름

### 📖 다이어그램 보는 방법

**✅ PlantUML 환경이 설정되어 있습니다!**

```bash
# 1. 다이어그램 파일 열기
code diagrams/class_diagram.puml

# 2. 미리보기 (Cursor/VS Code)
Alt + D
```

자세한 내용: [`diagrams/README.md`](diagrams/README.md) | [`diagrams/SETUP_GUIDE.md`](diagrams/SETUP_GUIDE.md)

## 🔑 API 키

### 오픈다트 API
- 발급: https://opendart.fss.or.kr
- 용도: 공시보고서 다운로드

### Gemini API
- 발급: https://aistudio.google.com/app/apikey
- 용도: AI 분석
- 권장: 유료 플랜 (무료는 일일 제한 있음)

## 📦 필요 패키지

```
requests>=2.25.1          # HTTP 요청
flask>=2.3.0             # 웹 서버
google-generativeai>=0.3.0  # Gemini API
markdown>=3.4.0          # Markdown → HTML
beautifulsoup4>=4.9.0    # XML 파싱
lxml>=4.6.0              # XML 처리
PyMuPDF>=1.23.0          # PDF 텍스트 추출
langchain>=0.1.0         # LangChain 프레임워크
langchain-community>=0.0.10  # LangChain 커뮤니티 패키지
faiss-cpu>=1.7.4         # FAISS 벡터 검색 (CPU 버전)
sentence-transformers>=2.2.0  # 문장 임베딩
```

## ⚙️ 동작 원리

```
사용자 입력 (회사명 + 질문)
    ↓
1. 오픈다트 API로 회사 고유번호 조회
    ↓
2. 🆕 Gemini AI가 사용자 질문 분석
    ├─ 최적 보고서 타입 추천
    └─ 🆕 시간 범위 추출 (예: "과거 5년간" → 5년)
    ↓
3. 추천된 보고서 타입 + 추출된 기간으로 공시보고서 검색
   (기본 3년, 최대 10년까지 가능)
    ↓
4. 🆕 VectorDB에서 보고서 캐시 확인
    ├─ ✅ 있으면: 캐시에서 즉시 로드 (API 호출 생략!)
    └─ ❌ 없으면: 오픈다트 API로 다운로드
    ↓
5. 메인 보고서 다운로드/로드 (ZIP) 및 압축 해제 (XML)
    ↓
6. 추가 DART 보고서 5개 다운로드/로드 (AI 추천 타입 우선)
    ↓
7. 🆕 기업의 산업군 자동 파악 (DART API + Gemini)
    ↓
8. 🆕 네이버 금융에서 증권사 리포트 수집
    ├─ 종목분석 리포트 (해당 기업, 최대 3개)
    └─ 산업분석 리포트 (해당 산업, 최대 2개)
    ↓
9. XML/PDF에서 텍스트 추출 (보고서당 최대 20만자)
    ↓
10. 🆕 추출된 보고서를 VectorDB에 저장 (다음 번 재사용)
    ↓
11. 모든 보고서를 통합하여 Gemini 2.5 Pro로 분석
    ├─ DART 공시 보고서: 기업의 공식 재무/사업 정보
    └─ 증권사 리포트: 시장 분석, 산업 동향, 전문가 견해
    ↓
12. Markdown → HTML 변환
    ↓
13. 웹 페이지에 아름답게 렌더링
    ↓
14. 🆕 오래된 다운로드 파일 자동 정리 (최신 5개만 유지)
```

## 💡 특징

### 1. 🆕 VectorDB 캐싱 시스템
- 💾 **FAISS + LangChain**으로 보고서를 VectorDB에 저장
- 🚀 **이미 다운로드한 보고서**는 캐시에서 즉시 로드 (API 호출 생략!)
- 🔍 **유사도 검색** 기능으로 관련 보고서 자동 추천 가능
- 📊 **메타데이터 관리**로 보고서 정보 효율적 관리
- 🧹 **자동 정리**: 분석 후 오래된 다운로드 파일 자동 삭제 (최신 5개만 유지)
- 💡 **이점**:
  - API 호출 횟수 대폭 감소 (비용 절감)
  - 분석 속도 향상 (다운로드 시간 생략)
  - 디스크 공간 절약 (중복 저장 방지)

### 2. 🆕 AI 기반 맞춤형 보고서 선택 + 스마트 기간 인식 + 연도별 보고서 수집
- 💡 사용자 질문을 **Gemini AI가 자동 분석**
- 📊 질문 내용에 **가장 적합한 보고서 타입 추천**
- 📅 질문에서 **시간 범위 자동 추출** (최대 10년)
- 📚 **NEW!** 장기 추세 분석 시 **여러 해의 사업보고서 자동 수집**
  - 한 보고서는 1-2년치 데이터만 포함
  - "과거 5년간" 요청 시 → 각 연도의 사업보고서 수집 (2024, 2023, 2022, 2021, 2020년)
  - 실제로 5년치 데이터를 확보!
- 🎯 예시:
  - "재무 상태" → 반기보고서, 분기보고서, 사업보고서
  - "투자 내역" → 주요사항보고서, 자율공시, 수시공시
  - "배당 정책" → 사업보고서, 주주총회소집공고
  - **"과거 5년간 실적"** → 2020~2024년 각 연도의 사업보고서 + 최신 반기보고서

### 3. 🆕 네이버 증권사 리포트 통합
- 📈 **종목분석 리포트** 자동 수집 (최대 3개)
  - 네이버 금융에서 해당 기업의 최신 증권사 리포트 크롤링
  - SK증권, 한국투자증권, 미래에셋증권 등 주요 증권사 리포트
  - PDF 다운로드 및 텍스트 추출
- 🏭 **산업분석 리포트** 자동 수집 (최대 2개)
  - 기업의 산업군을 자동 파악 (DART API + Gemini)
  - 해당 산업에 대한 최신 산업분석 리포트 수집
  - 시장 동향, 경쟁 환경, 성장 전망 등 제공
- 🎯 **시장 맥락 제공**
  - DART 공시: 기업의 공식적인 재무/사업 정보 (객관적 데이터)
  - 증권사 리포트: 전문 애널리스트의 시장 분석 및 투자 의견 (전문가 견해)
  - 두 출처를 결합하여 더 완전하고 균형 잡힌 분석 제공
- 💡 **자동화**
  - 기업명만 입력하면 자동으로 관련 리포트 수집
  - 별도 설정이나 URL 입력 불필요
  - 실시간으로 최신 리포트 반영

### 4. 스마트 분석 프로세스
- ✅ **기존 방식**: 고정된 3년치만 검색, 한 보고서만 사용
- ✅ **개선 방식**: 질문 맞춤형 보고서 타입 + 기간 자동 선택 + **연도별 보고서 다중 수집**
- 🎯 **예시**:
  - "2020년부터 현재까지 투자 내역" → 2020~2024년 각 연도의 사업보고서 + 주요사항보고서
  - "지난 10년간 매출 추이" → 2015~2024년 각 연도의 사업보고서
  - "사업 분석" → 최신 사업보고서 + 종목분석 리포트 3개 + 산업분석 리포트 2개

### 5. 다중 보고서 종합 분석
- ❌ 단일 보고서만 사용 X
- ✅ **메인 보고서 + DART 추가 보고서 5개 + 증권사 리포트 5개**를 함께 분석
- ✅ 시간에 따른 **변화 추세 파악** 가능
- ✅ **객관적 데이터 + 전문가 견해**를 결합한 균형 잡힌 분석
- ✅ 더욱 **종합적이고 정확한 분석**

### 6. PDF 파일 지원
- 📄 PyMuPDF로 PDF 텍스트 자동 추출
- 📊 증권사 리포트 등 PDF 문서도 분석 가능
- 📈 네이버 금융에서 증권사 PDF 리포트 자동 다운로드 및 추출
- 🔍 페이지별 텍스트 추출 및 구조화

### 7. 실시간 피드백
- 각 단계별 진행상황 실시간 표시
- 추가 보고서 다운로드 현황 표시
- 네이버 증권사 리포트 수집 진행상황 표시
- 상세한 로깅으로 디버깅 용이

### 8. 파일 다운로드
- 📦 ZIP 원본 파일
- 📄 XML 압축 해제 파일
- 📊 분석에 활용된 보고서 목록 표시
- 직접 확인 가능

### 9. 아름다운 UI
- Markdown 자동 렌더링
- 추가 보고서 구분 표시 (녹색 배경)
- 색상, 폰트, 레이아웃 최적화
- 반응형 디자인

## ⚠️ 주의사항

### API 제한
- **오픈다트**: 일일 호출 횟수 제한 있음
- **Gemini**: 유료 플랜 권장 (무료는 제한적)

### 분석 시간
- 회사 정보 조회: 30초~1분
- 보고서 다운로드: 5~10초
- AI 분석: 30초~1분
- **총 소요**: 약 1~2분

### 대상 회사
- 상장회사만 가능 (공시의무 있는 회사)
- 최근 3년 내 보고서가 있어야 함

## 🎬 실제 사용 예시

### 삼성전자 재무 분석
```
회사명: 삼성전자
질문: 최근 반기 재무 상태는 어떤가요? 매출과 영업이익 추이를 분석해주세요.

→ Gemini가 558,804자의 반기보고서를 전체 분석
→ 매출, 영업이익, 순이익 등 구체적 수치 제공
→ 전년 대비 증감률 및 원인 분석
→ 투자 시사점 제시
```

### SK텔레콤 사업 분석
```
회사명: SK텔레콤
질문: 주요 사업 부문별 실적과 향후 전망을 분석해주세요.

→ Gemini가 333,818자의 반기보고서를 전체 분석
→ 통신, 미디어, 커머스 등 사업부문별 실적 분석
→ 시장 환경 및 경쟁 상황 평가
→ 향후 성장 전략 및 리스크 분석
```

## 🌟 프로젝트 하이라이트

### Context Window 활용
```
Gemini 2.5 Pro: 1,000,000 토큰
삼성전자 보고서: 140,000 토큰
━━━━━━━━━━━━━━━━━━━━━━━
여유 공간: 86% 🎉

→ 보고서 전체를 입력할 수 있습니다!
```

### 정확성
- ✅ 보고서의 모든 섹션 검토
- ✅ 구체적 수치 인용
- ✅ 근거 기반 분석
- ✅ 추측 없이 팩트만 제공

## 🛠️ 기술 스택

- **Backend**: Python 3.8+, Flask 2.3+
- **AI**: Google Gemini 2.5 Pro (1M context window)
- **Data**: 오픈다트(DART) API
- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **Rendering**: Markdown → HTML with styling

## 📚 API 문서

### 오픈다트 API
- 공시검색: `/api/list.json`
- 고유번호: `/api/corpCode.xml`
- 보고서: `/api/document.xml`

### Gemini API
- 모델: `models/gemini-2.5-pro-preview-03-25`
- Context: 1,000,000 토큰
- 확장: extra, nl2br, sane_lists, tables

## 🔧 환경 설정

### API 키 변경
`app.py` 파일:
```python
DART_API_KEY = "여기에_오픈다트_API_키"
GEMINI_API_KEY = "여기에_Gemini_API_키"
```

### 포트 변경
```python
app.run(debug=True, host='0.0.0.0', port=5000)
```

## 📊 지원 보고서

### AI가 자동 선택하는 보고서 타입
사용자 질문을 분석하여 아래 보고서 타입 중 가장 적합한 것을 자동으로 선택합니다:

#### 정기 보고서
- ✅ **사업보고서** - 연간 사업 내용, 재무제표, 경영 전반 종합
- ✅ **반기보고서** - 반기(6개월) 단위 재무 및 사업 현황
- ✅ **분기보고서** - 분기(3개월) 단위 재무 및 사업 현황

#### 수시 공시
- ✅ **주요사항보고서** - 합병, 분할, 자산양수도 등 중요 경영사항
- ✅ **기타경영사항(자율공시)** - 회사의 자율적 경영 정보
- ✅ **조회공시요구** - 거래소 요구 공시
- ✅ **수시공시** - 중요 사건 발생 시 즉시 공시
- ✅ **공정공시** - 투자자에게 공정하게 제공하는 정보

#### 기타 공시
- ✅ **주주총회소집공고** - 주주총회 개최 및 안건
- ✅ **증권발행실적(자율공시)** - 증권 발행 내역

### 파일 형식
- ✅ XML (공시보고서 기본 형식)
- ✅ PDF (텍스트 추출 지원)

## 🎉 성공 사례

### 🆕 AI 맞춤형 보고서 선택 + 스마트 기간 인식 예시
```
질문: "최근 투자나 인수합병이 있었나요?"
→ AI 추천: 주요사항보고서, 자율공시, 수시공시
→ 기간: 3년 (기본값)
→ 해당 보고서 타입만 검색하여 분석

질문: "배당 정책이 어떻게 되나요?"
→ AI 추천: 사업보고서, 주주총회소집공고
→ 기간: 3년 (기본값)
→ 배당 관련 정보가 있는 보고서만 다운로드

질문: "과거 5년간 재무 상태 추이를 분석해주세요."
→ AI 분석:
  - 추천 타입: 반기보고서, 분기보고서, 사업보고서
  - 기간: 5년 (질문에서 추출)
  - 장기 추세: Yes (여러 해의 보고서 필요)
→ 수집:
  - 📅 2024년 사업보고서
  - 📅 2023년 사업보고서
  - 📅 2022년 사업보고서
  - 📅 2021년 사업보고서
  - 📅 2020년 사업보고서
  - 📄 2025년 최신 반기보고서
→ 결과: 실제로 5년간의 재무 데이터 확보!

질문: "2020년부터 현재까지 주요 투자 내역"
→ AI 분석:
  - 추천 타입: 주요사항보고서, 자율공시
  - 기간: 5년 (2020~2025)
  - 장기 추세: Yes
→ 수집:
  - 📅 2020~2024년 각 연도의 사업보고서
  - 📄 최근 주요사항보고서
→ 5년간의 모든 투자 이력 종합 분석

질문: "지난 10년간 인수합병 이력이 있나요?"
→ AI 분석:
  - 추천 타입: 주요사항보고서, 수시공시, 사업보고서
  - 기간: 10년
  - 장기 추세: Yes
→ 수집:
  - 📅 2015~2024년 각 연도의 사업보고서 (10개)
  - 📄 최근 주요사항보고서, 수시공시
→ 10년간의 M&A 이력 전체 분석
```

### 실제 분석 결과
```
✅ 삼성전자 반기보고서 분석 성공
   - 보고서: 558,804자
   - 분석 시간: 약 1분
   - 결과: 4,984자 (Markdown)
   - HTML 렌더링: 8,751자

✅ SK텔레콤 반기보고서 분석 성공
   - 보고서: 333,818자
   - 분석 시간: 약 1분
   - 결과: 6,488자 (Markdown)
   - HTML 렌더링: 7,999자
```

## 📝 라이선스

이 프로젝트는 교육 및 연구 목적으로 사용할 수 있습니다.

## 🛠️ 유틸리티 스크립트

### 기존 파일 마이그레이션
이미 다운로드한 파일들을 VectorDB로 마이그레이션하려면:

```bash
python migrate_to_vectordb.py
```

이 스크립트는:
1. `downloads` 폴더의 모든 XML 파일 검색
2. 각 파일에서 텍스트 추출
3. VectorDB에 저장
4. (선택) 마이그레이션 후 원본 파일 정리

### VectorDB 통계 확인
```python
from vector_store import VectorStore

vs = VectorStore()
vs.print_stats()
```

출력 예시:
```
📊 벡터DB 통계
═══════════════════════════════════════════════
총 보고서 수: 17개
총 청크 수: 8,542개
총 데이터 크기: 8,542,125자
회사 수: 1개
회사 목록: KT
저장 경로: vector_db
═══════════════════════════════════════════════
```

## 🔗 참고 링크

- [오픈다트 API](https://opendart.fss.or.kr)
- [Gemini API](https://ai.google.dev)
- [금융감독원 전자공시](https://dart.fss.or.kr)
- [FAISS](https://github.com/facebookresearch/faiss)
- [LangChain](https://python.langchain.com)

---

**Made with ❤️ using DART API & Gemini AI**

🎯 **보고서 전문 분석** | 💪 **1M Context Window** | 🎨 **Beautiful UI**
