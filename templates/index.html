<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기업 분석 AI - DART & 네이버 증권사 리포트 & Gemini & Midm</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <!-- KT Logo Header -->
    <div class="kt-header">
        <img src="/static/01_KT Wordmark (Standard)_01.png" alt="KT" class="kt-logo">
    </div>

    <div class="container">
        <div class="header">
            <h1>🔍 기업 분석 AI</h1>
            <p>공시자료 × 증권사 리포트 × Gemini × Midm AI로 기업을 분석합니다</p>
        </div>

        <div class="card">
            <form id="analysisForm">
                <div class="form-group">
                    <label for="companyName">📊 분석할 회사명</label>
                    <input 
                        type="text" 
                        id="companyName" 
                        name="company_name" 
                        placeholder="예: KT, 삼성전자, 현대자동차"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="userQuery">💬 분석하고 싶은 내용</label>
                    <textarea 
                        id="userQuery" 
                        name="user_query" 
                        placeholder="예: 최근 재무 상태는 어떤가요? 주요 사업 내용과 실적을 분석해주세요."
                        required
                    ></textarea>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    🚀 분석 시작
                </button>
            </form>

            <!-- VectorDB 관리 섹션 -->
            <div class="admin-section">
                <h3>⚙️ VectorDB 관리</h3>
                <div class="vectordb-stats" id="vectordbStats">
                    <div class="stat-item">📊 통계 로딩 중...</div>
                </div>
                <button type="button" class="btn btn-danger btn-small" id="resetVectorDbBtn" onclick="resetVectorDB()">
                    🗑️ VectorDB 초기화
                </button>
            </div>

            <div class="example-queries">
                <h3>💡 질문 예시</h3>
                <ul>
                    <li onclick="setQuery('최근 재무 상태는 어떤가요? 매출과 영업이익 추이를 분석해주세요.')">최근 재무 상태는 어떤가요? 매출과 영업이익 추이를 분석해주세요.</li>
                    <li onclick="setQuery('주요 사업 내용과 경쟁력을 분석해주세요.')">주요 사업 내용과 경쟁력을 분석해주세요.</li>
                    <li onclick="setQuery('주요 투자 위험 요인은 무엇인가요?')">주요 투자 위험 요인은 무엇인가요?</li>
                    <li onclick="setQuery('향후 성장 전략과 전망을 분석해주세요.')">향후 성장 전략과 전망을 분석해주세요.</li>
                </ul>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div class="loading-text">분석 중입니다... 잠시만 기다려주세요.</div>
                <div style="color: #999; margin-top: 10px; font-size: 0.9rem;">
                    DART 공시 + 증권사 리포트 수집 및 AI 분석 진행 중 (약 5~10분 소요)
                </div>
                <div class="status-log" id="statusLog">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #E30613;">📊 실시간 진행상황</div>
                    <div id="statusMessages"></div>
                </div>

                <!-- 시스템 아키텍처 다이어그램 -->
                <div class="architecture-diagram" id="architectureDiagram">
                    <h4>🏗️ 시스템 아키텍처 실시간 모니터링</h4>
                    <div class="diagram-container">
                        <!-- Frontend -->
                        <div class="component comp-frontend" id="comp-frontend">
                            <div class="component-icon">🖥️</div>
                            <div class="component-label">Frontend</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- Web Server -->
                        <div class="component comp-webserver" id="comp-webserver">
                            <div class="component-icon">⚙️</div>
                            <div class="component-label">Flask Server</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- DART API -->
                        <div class="component comp-dart" id="comp-dart">
                            <div class="component-icon">📋</div>
                            <div class="component-label">DART API</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- Naver Finance -->
                        <div class="component comp-naver" id="comp-naver">
                            <div class="component-icon">📊</div>
                            <div class="component-label">Naver Finance</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- VectorDB -->
                        <div class="component comp-vectordb" id="comp-vectordb">
                            <div class="component-icon">💾</div>
                            <div class="component-label">VectorDB</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- Midm LLM -->
                        <div class="component comp-midm" id="comp-midm">
                            <div class="component-icon">🤖</div>
                            <div class="component-label">Midm AI</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- Gemini LLM -->
                        <div class="component comp-gemini" id="comp-gemini">
                            <div class="component-icon">✨</div>
                            <div class="component-label">Gemini AI</div>
                            <div class="component-status">대기중</div>
                        </div>

                        <!-- SVG for connection lines -->
                        <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5;">
                            <defs>
                                <!-- 화살표 마커 -->
                                <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto" class="arrow-marker">
                                    <path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#E30613" />
                                </marker>
                                
                                <!-- 흐름 효과용 그라디언트 -->
                                <linearGradient id="arrowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#E30613;stop-opacity:0" />
                                    <stop offset="50%" style="stop-color:#E30613;stop-opacity:0.8" />
                                    <stop offset="100%" style="stop-color:#E30613;stop-opacity:0" />
                                </linearGradient>
                            </defs>
                            
                            <!-- JavaScript가 여기에 화살표를 그립니다 -->
                            <g id="flowLines"></g>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="error" id="error"></div>
        </div>

        <div class="card result" id="result">
            <div class="result-header">
                <h2 id="resultCompanyName"></h2>
                <div class="result-meta" id="resultMeta"></div>
                <div style="margin-top: 15px;">
                    <button id="downloadPdfBtn" class="btn" style="background: #000; display: none;" onclick="downloadPDF()">
                        📄 PDF로 다운로드
                    </button>
                </div>
            </div>

            <div class="reports-found" id="reportsFound" style="display: none;">
                <h4>📑 발견된 DART 공시 보고서</h4>
                <ul id="reportsList"></ul>
            </div>

            <div class="reports-found" id="additionalReports" style="display: none; background: #f0fff4; border-left: 4px solid #48bb78;">
                <h4>📚 분석에 활용된 DART 추가 보고서</h4>
                <ul id="additionalReportsList"></ul>
            </div>

            <div class="reports-found" id="naverCompanyReports" style="display: none; background: #fffaf0; border-left: 4px solid #ed8936;">
                <h4>📊 활용된 종목분석 리포트 (증권사)</h4>
                <ul id="naverCompanyReportsList"></ul>
            </div>

            <div class="reports-found" id="naverIndustryReports" style="display: none; background: #f0f9ff; border-left: 4px solid #4299e1;">
                <h4>🏭 활용된 산업분석 리포트 (증권사)</h4>
                <ul id="naverIndustryReportsList"></ul>
            </div>

            <div class="result-content" id="resultContent"></div>
        </div>
    </div>

    <!-- External JavaScript (순서 중요: 의존성 고려) -->
    <script src="/static/js/diagram.js"></script>
    <script src="/static/js/vectordb.js"></script>
    <script src="/static/js/analysis.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
